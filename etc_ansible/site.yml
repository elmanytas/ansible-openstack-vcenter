#
# Database services
- hosts: databases
  roles:
  - ntp
  - sql-database
  - message-queue
  - memcached
  tags:
  - databases
  - sql-database
  - postgresql
  - mysql
  - message-queue
  - rabbitmq
  - memcached

# Keystone service
- hosts: identity
  roles:
  - ntp
  - identity
  environment:
    OS_TOKEN: "{{ administration_token }}"
    OS_URL: "http://{{ admin_hostname }}:35357/v3"
    OS_IDENTITY_API_VERSION: 3
  tags:
  - identity
  - keystone

# Image service
- hosts: image
  roles:
  - ntp
  - image
  environment:
    OS_TOKEN: "{{ administration_token }}"
    OS_URL: "http://{{ admin_hostname }}:35357/v3"
    OS_IDENTITY_API_VERSION: 3
  tags:
  - image
  - glance

# Networking and compute services
- hosts: networking-compute-controller
  roles:
  - ntp
  - networking-compute-controller
  environment:
    OS_PROJECT_DOMAIN_NAME: "{{ keystone_default_project_name }}"
    OS_USER_DOMAIN_NAME: "{{ keystone_default_domain_name }}"
    OS_PROJECT_NAME: "{{ keystone_admin_project_name }}"
    OS_USERNAME: "{{ keystone_admin_name }}"
    OS_PASSWORD: "{{ keystone_admin_password }}"
    OS_AUTH_URL: "http://{{ admin_hostname }}:35357/v3"
    OS_URL: "http://{{ admin_hostname }}:35357/v3"
    OS_IDENTITY_API_VERSION: 3
  tags:
  - networking-compute-controller
  - controller
  - networking

# Dashboard service
- hosts: dashboard
  roles:
#  - ntp
  - dashboard
  tags:
  - dashboard
  - horizon

# Block Storage service
- hosts: block-storage
  roles:
#  - ntp
  - block-storage
  environment:
    OS_TOKEN: "{{ administration_token }}"
    OS_URL: "http://{{ admin_hostname }}:35357/v3"
    OS_IDENTITY_API_VERSION: 3
  tags:
  - cinder
  - block-storage

# Ochestration service
- hosts: orchestation
  roles:
#  - ntp
  - orchestation
  environment:
    OS_TOKEN: "{{ administration_token }}"
    OS_URL: "http://{{ admin_hostname }}:35357/v3"
    OS_IDENTITY_API_VERSION: 3
  tags:
  - heat
  - orchestation
  - cloudformation

# Adding hypervisors
- hosts: kvm-hypervisor
  roles:
  - ntp
  - kvm-hypervisor
  tags:
  - kvm-hypervisor
  - compute

- hosts: lxd-hypervisor
  roles:
  - ntp
  - lxd-hypervisor
  tags:
  - lxd-hypervisor
  - compute
